# nat-tunnel-2024 üåê

[![GitHub stars](https://img.shields.io/github/stars/Shiro-nn/nat-tunnel-2024?style=social)](https://github.com/Shiro-nn/nat-tunnel-2024/stargazers)
[![GitHub forks](https://img.shields.io/github/forks/Shiro-nn/nat-tunnel-2024?style=social)](https://github.com/Shiro-nn/nat-tunnel-2024/network/members)
[![GitHub issues](https://img.shields.io/github/issues/Shiro-nn/nat-tunnel-2024)](https://github.com/Shiro-nn/nat-tunnel-2024/issues)
[![GitHub last commit](https://img.shields.io/github/last-commit/Shiro-nn/nat-tunnel-2024)](https://github.com/Shiro-nn/nat-tunnel-2024/commits)
[![License: MIT](https://img.shields.io/github/license/Shiro-nn/nat-tunnel-2024)](LICENSE)
[![Status: Archived](https://img.shields.io/badge/status-archived-lightgrey.svg)](https://github.com/Shiro-nn/nat-tunnel-2024)

![Repo Stats](https://github-readme-stats.vercel.app/api/pin/?username=Shiro-nn&repo=nat-tunnel-2024)

> **nat-tunnel-2024** ‚Äî —ç—Ç–æ –ø—Ä–æ–µ–∫—Ç, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π NAT-—Ç—É–Ω–Ω–µ–ª—å –Ω–∞ —è–∑—ã–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è Rust. –ü—Ä–æ–µ–∫—Ç –±—ã–ª —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –≤ 2024 –≥–æ–¥—É –∏ –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –≤ **–∞—Ä—Ö–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º**. –ö–æ–¥ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –¥–æ—Å—Ç—É–ø–µ ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª ‚Äî –±–µ–∑ –≥–∞—Ä–∞–Ω—Ç–∏–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –Ω–æ–≤—ã—Ö —Ä–µ–ª–∏–∑–æ–≤. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–æ–≤.

---

## üìÇ –°–æ—Å—Ç–∞–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

| –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è  | –Ø–∑—ã–∫/—Å—Ç–µ–∫                                          | –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ                                                                                                              |
| ----------- | -------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- |
| **`src`**   | **Rust** (`tokio`, `yamux`, `tun`, `clap`)         | –°–æ–¥–µ—Ä–∂–∏—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ (`client.rs`) –∏ —Å–µ—Ä–≤–µ—Ä–∞ (`server.rs`), —Ä–µ–∞–ª–∏–∑—É—é—â–∏—Ö NAT-—Ç—É–Ω–Ω–µ–ª—å —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Yamux –¥–ª—è –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è. |

> **–í–∞–∂–Ω–æ:** –ö–ª–∏–µ–Ω—Ç –∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è **–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ** –∏ –Ω–µ —Å–≤—è–∑–∞–Ω—ã –µ–¥–∏–Ω–æ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–µ–π ‚Äî –∫–∞–∂–¥—ã–π –∏–º–µ–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –≤ `Cargo.toml`.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)

### –ö–ª–∏–µ–Ω—Ç (`nat-tunnel-client`)

```bash
git clone https://github.com/Shiro-nn/nat-tunnel-2024.git
cd nat-tunnel-2024
cargo build --release
sudo ./target/release/nat-tunnel-client --server <server_ip:port> --vip <virtual_ip> --mtu <mtu>
```

- `<server_ip:port>` ‚Äî –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `127.0.0.1:7000`).
- `<virtual_ip>` ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π IP –¥–ª—è TUN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `10.2.0.2`).
- `<mtu>` ‚Äî MTU –¥–ª—è TUN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `1400`).

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è —Ä–∞–±–æ—Ç—ã TUN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –º–æ–≥—É—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –ø—Ä–∞–≤–∞ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –°–µ—Ä–≤–µ—Ä (`nat-tunnel-server`)

```bash
cargo build --release
./target/release/nat-tunnel-server --bind <bind_address> --public-port <public_port>
```

- `<bind_address>` ‚Äî –∞–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0.0.0.0:7000`).
- `<public_port>` ‚Äî –ø–æ—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `8080`).

---

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

- **–ö–ª–∏–µ–Ω—Ç** (`nat-tunnel-client`): –°–æ–∑–¥–∞—ë—Ç TUN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º —á–µ—Ä–µ–∑ Yamux. –ü–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –ø–∞–∫–µ—Ç—ã –∏–∑ TUN –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏ –æ–±—Ä–∞—Ç–Ω–æ.
- **–°–µ—Ä–≤–µ—Ä** (`nat-tunnel-server`): –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ø—É–±–ª–∏—á–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞. –ü–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –º–µ–∂–¥—É –ø—É–±–ª–∏—á–Ω—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ –∏ Yamux-—Å–µ—Å—Å–∏—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤.

```mermaid
graph LR
    subgraph –ö–ª–∏–µ–Ω—Ç
        A[TUN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å]
        B[Yamux-–∫–ª–∏–µ–Ω—Ç]
    end
    subgraph –°–µ—Ä–≤–µ—Ä
        C[Yamux-—Å–µ—Ä–≤–µ—Ä]
        D[–ü—É–±–ª–∏—á–Ω—ã–π –ø–æ—Ä—Ç]
    end
    A <--> B
    B <--> C
    C <--> D
```

---

## üõ†Ô∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Rust 1.75+** –∏ `cargo` –¥–ª—è —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞.
- **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: `anyhow`, `bytes`, `clap`, `log`, `env_logger`, `tokio`, `tun`, `yamux`.
- **–ü—Ä–∞–≤–∞ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è TUN-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.

---

## ü§ù –í–∫–ª–∞–¥

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π **–∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω**. –î–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –∏–¥–µ–π ‚Äî —Ñ–æ—Ä–∫–∞–π—Ç–µ –∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ.

---

## ‚öñÔ∏è –õ–∏—Ü–µ–Ω–∑–∏—è

–ö–æ–¥ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π **MIT**. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ, –Ω–æ –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –≥–∞—Ä–∞–Ω—Ç–∏–π.

> –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å! –ù–∞–¥–µ—é—Å—å, –ø—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ –æ–∫–∞–∂—É—Ç—Å—è –ø–æ–ª–µ–∑–Ω—ã–º–∏ –≤ –≤–∞—à–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö.
